[English](../README.md) Â· [Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©](README.ar.md) Â· [EspaÃ±ol](README.es.md) Â· [FranÃ§ais](README.fr.md) Â· [æ—¥æœ¬èª](README.ja.md) Â· [í•œêµ­ì–´](README.ko.md) Â· [Tiáº¿ng Viá»‡t](README.vi.md) Â· [ä¸­æ–‡ (ç®€ä½“)](README.zh-Hans.md) Â· [ä¸­æ–‡ï¼ˆç¹é«”ï¼‰](README.zh-Hant.md) Â· [Deutsch](README.de.md) Â· [Ğ ÑƒÑÑĞºĞ¸Ğ¹](README.ru.md)


# ç±»å™¨å®˜åˆ†å‰²ï¼ˆWeb + CLIï¼‰

![Python](https://img.shields.io/badge/Python-3.x-blue.svg)
![Framework](https://img.shields.io/badge/Backend-Tornado-009688.svg)
![AI](https://img.shields.io/badge/OpenAI-Vision%20Segmentation-412991.svg)
![Status](https://img.shields.io/badge/README-First%20Complete%20Draft-success.svg)
![Interface](https://img.shields.io/badge/UI-Web%20%2B%20CLI-0ea5e9)
![Outputs](https://img.shields.io/badge/Artifacts-Overlay%20%7C%20Mask%20%7C%20JSON-f97316)
![PWA](https://img.shields.io/badge/PWA-Minimal%20Support-22c55e)

è¿™æ˜¯ä¸€ä¸ª Python åº”ç”¨ï¼Œä½¿ç”¨å…·å¤‡è§†è§‰èƒ½åŠ›çš„ OpenAI æ¨¡å‹å¯¹æ˜¾å¾®é•œå›¾åƒä¸­çš„ç±»å™¨å®˜è¿›è¡Œåˆ†å‰²ã€‚

æœ¬ä»“åº“åŒ…å«ï¼š
- å¸¦ä¸Šä¼ ç•Œé¢çš„ Tornado Web æœåŠ¡å™¨ã€‚
- ç”¨äºæ‰¹å¤„ç†æˆ–è„šæœ¬åŒ–ä½¿ç”¨çš„ CLI å·¥ä½œæµã€‚
- å¤šè¾¹å½¢æå–ã€æ©ç ç”Ÿæˆä¸æ ‡æ³¨å›¾åƒæ¸²æŸ“ã€‚
- æœ€å°åŒ– PWA æ”¯æŒï¼ˆmanifest + æ ¸å¿ƒé™æ€èµ„æºçš„ service worker ç¼“å­˜ï¼‰ã€‚

## ğŸ” æ¦‚è§ˆ

è¯¥åº”ç”¨æ¥æ”¶è¾“å…¥çš„æ˜¾å¾®é•œå›¾åƒï¼Œå°†å…¶è¿åŒä¸¥æ ¼ JSON schema çš„æç¤ºè¯å‘é€ç»™ OpenAI æ¨¡å‹ï¼Œå¹¶è¿”å›ä¸€æ¡ç”¨äºæç»˜ç±»å™¨å®˜è¾¹ç•Œçš„å•ä¸€å¤šè¾¹å½¢ã€‚

### ğŸ“Œ é€Ÿè§ˆ

| åŒºåŸŸ | è¯¦æƒ… |
|---|---|
| è¾“å…¥ | æ˜¾å¾®é•œå›¾åƒ |
| æ ¸å¿ƒè¾“å‡º | ç±»å™¨å®˜å¤šè¾¹å½¢ï¼ˆ`x, y` ç‚¹ï¼‰ |
| è¡ç”Ÿæ–‡ä»¶ | æ ‡æ³¨å åŠ  PNGã€äºŒå€¼æ©ç  PNGã€å¤šè¾¹å½¢ JSON |
| è®¿é—®æ–¹å¼ | Web UIã€CLIã€ç›´æ¥ API è°ƒç”¨ |
| åç«¯ | Tornadoï¼ˆ`server.py`ï¼‰ |
| AI è·¯å¾„ | ä¼˜å…ˆ OpenAI Responses APIï¼Œå›é€€ Chat Completions |

ç”Ÿæˆäº§ç‰©ï¼š
- `*_annotated.png`ï¼šå¸¦åŠé€æ˜çº¢è‰²å åŠ å±‚çš„æºå›¾ã€‚
- `*_mask.png`ï¼šç±»å™¨å®˜äºŒå€¼æ©ç ã€‚
- `*_polygon.json`ï¼šç»“æ„åŒ–è¾“å‡ºï¼ˆ`width`, `height`, `polygon`, `confidence`ï¼‰ã€‚

ä¸»è¦è¿è¡Œæ—¶æ–‡ä»¶ï¼š
- `server.py`ï¼šWeb åº”ç”¨ + API è·¯ç”±ã€‚
- `organoid_segmenter.py`ï¼šåˆ†å‰²ä¸å›¾åƒ/æ©ç è¾“å‡ºé€»è¾‘ã€‚
- `segment_organoid.py`ï¼šCLI åŒ…è£…å™¨ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- åœ¨ `http://localhost:8888` æä¾› Web UIï¼Œç”¨äºå¿«é€Ÿäº¤äº’å¼åˆ†å‰²ã€‚
- æä¾›ç±» REST æ¥å£ `POST /api/segment`ï¼Œæ”¯æŒ multipart ä¸Šä¼ ã€‚
- UI ä¸ CLI å¯é…ç½®æ¨¡å‹åï¼ˆé»˜è®¤ `gpt-4o-2024-08-06`ï¼‰ã€‚
- å¯¹å¤šè¾¹å½¢ç‚¹è¿›è¡Œæ ¡éªŒå¹¶é™åˆ¶åœ¨å›¾åƒè¾¹ç•Œå†…ã€‚
- è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•ï¼ˆ`uploads/`, `outputs/`ï¼‰ã€‚
- ä»£ç è·¯å¾„ä¸­ä¼˜å…ˆä½¿ç”¨ OpenAI Responses APIï¼Œå¹¶åœ¨å¤±è´¥æ—¶å›é€€ Chat Completionsã€‚
- æ”¯æŒä½¿ç”¨ service worker ç¼“å­˜æ ¸å¿ƒé™æ€æ–‡ä»¶ã€‚

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```text
Yinghan/
â”œâ”€ organoid_segmenter.py          # Core segmentation logic and output rendering
â”œâ”€ segment_organoid.py            # CLI entrypoint
â”œâ”€ server.py                      # Tornado server + API
â”œâ”€ requirements.txt               # Python dependencies
â”œâ”€ templates/
â”‚  â””â”€ index.html                  # Web UI shell
â”œâ”€ static/
â”‚  â”œâ”€ app.js                      # Frontend upload + result rendering logic
â”‚  â”œâ”€ styles.css                  # UI styles
â”‚  â”œâ”€ manifest.json               # PWA manifest
â”‚  â””â”€ sw.js                       # Service worker cache logic
â”œâ”€ i18n/                          # Localized README files (planned/generated by pipeline)
â”œâ”€ uploads/                       # Runtime upload storage (gitignored)
â”œâ”€ outputs/                       # Runtime segmentation outputs (gitignored, created at runtime)
â””â”€ .auto-readme-work/             # README generation pipeline context/artifacts
```

## âœ… å‰ç½®è¦æ±‚

- Python 3.10+ï¼ˆè¦æ±‚ 3.xï¼›æ¨è 3.11ï¼‰ã€‚
- æ‹¥æœ‰å¯è®¿é—®è§†è§‰æ¨¡å‹çš„ OpenAI API keyã€‚
- è¿è¡Œç¯å¢ƒå¯è®¿é—® OpenAI APIs çš„ç½‘ç»œã€‚

## âš™ï¸ å®‰è£…

```bash
git clone <your-repo-url>
cd Yinghan

python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate

pip install -r requirements.txt
```

è®¾ç½®ä½ çš„ API keyï¼š

```bash
export OPENAI_API_KEY="your_api_key_here"  # Windows PowerShell: $env:OPENAI_API_KEY="your_api_key_here"
```

## ğŸš€ ä½¿ç”¨

### ğŸŒ è¿è¡Œ Web åº”ç”¨

```bash
python server.py
```

æ‰“å¼€ï¼š

```text
http://localhost:8888
```

Web æµç¨‹ï¼š
1. é€‰æ‹©å›¾åƒã€‚
2. å¯é€‰ï¼šåœ¨è¾“å…¥æ¡†ä¸­ä¿®æ”¹æ¨¡å‹ã€‚
3. ç‚¹å‡» **Segment**ã€‚
4. æŸ¥çœ‹å åŠ ç»“æœã€æ ‡æ³¨å›¾ä¸æ©ç ã€‚

### ğŸ§ª è¿è¡Œ CLI

```bash
python segment_organoid.py /path/to/image.jpg
```

å¯é€‰å‚æ•°ï¼š

```bash
python segment_organoid.py /path/to/image.jpg --out-dir outputs --model gpt-4o-2024-08-06
```

CLI ä¼šæ‰“å°è¾“å‡ºè·¯å¾„å’Œæ‘˜è¦ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«å›¾åƒå°ºå¯¸ä¸å¤šè¾¹å½¢ç‚¹æ•°é‡ã€‚

### ğŸ”Œ ç›´æ¥è°ƒç”¨ API

```bash
curl -X POST http://localhost:8888/api/segment \
  -F "image=@/path/to/image.jpg" \
  -F "model=gpt-4o-2024-08-06"
```

ç¤ºä¾‹å“åº”ç»“æ„ï¼š

```json
{
  "width": 1024,
  "height": 1024,
  "polygon": [[100.0, 120.0], [110.0, 125.0]],
  "confidence": 0.92,
  "annotated_url": "/outputs/example_annotated.png",
  "mask_url": "/outputs/example_mask.png",
  "json_url": "/outputs/example_polygon.json",
  "upload_url": "/uploads/upload.jpg"
}
```

## ğŸ› ï¸ é…ç½®

å½“å‰ä»£ç ä¸­å¯é…ç½®å‚æ•°ï¼š

- `model`:
  - é»˜è®¤ï¼š`gpt-4o-2024-08-06`
  - å¯é€šè¿‡ Web è¡¨å•è¾“å…¥æˆ– CLI `--model` è®¾ç½®
- `out_dir`:
  - CLI é€‰é¡¹ `--out-dir`ï¼ˆé»˜è®¤ `outputs`ï¼‰
  - Server å†…éƒ¨ä½¿ç”¨ `outputs/`

ç¯å¢ƒå˜é‡ï¼š
- `OPENAI_API_KEY`ï¼ˆå¿…éœ€ï¼‰ã€‚

å‡è®¾ï¼š
- `OpenAI()` å®¢æˆ·ç«¯ä½¿ç”¨åŸºäºç¯å¢ƒå˜é‡çš„å‡­æ®ã€‚
- é™¤éä½ çš„ OpenAI è´¦æˆ·é…ç½®è¦æ±‚ï¼Œå¦åˆ™ä¸éœ€è¦è‡ªå®šä¹‰ base URL æˆ– org/project è®¾ç½®ã€‚

## ğŸ§¾ ç¤ºä¾‹

### ğŸ Python ç¼–ç¨‹è°ƒç”¨ç¤ºä¾‹

```python
from organoid_segmenter import segment_organoid

result = segment_organoid(
    image_path="sample.jpg",
    out_dir="outputs",
    model="gpt-4o-2024-08-06",
)

print(result.annotated_path)
print(result.mask_path)
print(result.json_path)
print(result.confidence)
```

### ğŸ“„ æŸ¥çœ‹ Polygon JSON

```bash
cat outputs/<name>_polygon.json
```

### ğŸ§± å…¸å‹è¾“å‡ºæ–‡ä»¶

```text
outputs/
â”œâ”€ <base>_<timestamp>_annotated.png
â”œâ”€ <base>_<timestamp>_mask.png
â””â”€ <base>_<timestamp>_polygon.json
```

## ğŸ§  å¼€å‘è¯´æ˜

- åç«¯æ¡†æ¶ï¼šTornadoï¼ˆ`server.py`ï¼‰ã€‚
- å‰ç«¯æŠ€æœ¯æ ˆï¼šé™æ€ HTML/CSS/JSï¼ˆ`templates/index.html`, `static/app.js`ï¼‰ã€‚
- é¡µé¢åŠ è½½æ—¶æ³¨å†Œ service workerï¼Œå¹¶ç¼“å­˜ `static/sw.js` ä¸­åˆ—å‡ºçš„æ ¸å¿ƒèµ„æºã€‚
- å¤šè¾¹å½¢æ ¡éªŒç¡®ä¿è‡³å°‘ 3 ä¸ªç‚¹ï¼Œå¹¶å°†åæ ‡é™åˆ¶åœ¨å›¾åƒè¾¹ç•Œå†…ã€‚
- è¾“å‡ºç”Ÿæˆä½¿ç”¨ Pillowï¼ˆ`PIL.Image`, `ImageDraw`ï¼‰ã€‚

æœ¬åœ°å¼€å‘æç¤ºï¼š

```bash
# Run server
python server.py

# Run CLI against an existing image
python segment_organoid.py 6f1e1874eacffe1dbae0393f48811e74.jpg
```

## ğŸ©º æ•…éšœæ’æŸ¥

- `openai.AuthenticationError` æˆ–ç±»ä¼¼é”™è¯¯ï¼š
  - ç¡®è®¤åœ¨è¿è¡Œ Python çš„ shell ä¸­å·²è®¾ç½® `OPENAI_API_KEY`ã€‚
- `Model response did not contain valid JSON`ï¼š
  - å°è¯•æ›´æ¢æ¨¡å‹æˆ–é‡æ–°è¿è¡Œï¼›è™½ç„¶å·²å®ç°å›é€€è§£æï¼Œä½†è¾“å‡ºæ ¼å¼é”™è¯¯ä»å¯èƒ½å¤±è´¥ã€‚
- `Polygon must contain at least 3 points`ï¼š
  - æ¨¡å‹è¿”å›äº†æ— æ•ˆå¤šè¾¹å½¢ï¼›è¯·ä½¿ç”¨æ›´æ¸…æ™°çš„å›¾åƒé‡è¯•ã€‚
- UI å¯ä»¥åŠ è½½ä½†åˆ†å‰²å¤±è´¥ï¼š
  - æ£€æŸ¥æœåŠ¡ç«¯æ—¥å¿—ä¸­ `/api/segment` è¿”å›çš„å¼‚å¸¸ç±»å‹ã€‚
- `ModuleNotFoundError`ï¼š
  - åœ¨å½“å‰æ¿€æ´»ç¯å¢ƒä¸­é‡æ–°æ‰§è¡Œ `pip install -r requirements.txt` å®‰è£…ä¾èµ–ã€‚

## ğŸ›£ï¸ è·¯çº¿å›¾

æœ¬ä»“åº“çš„æ½œåœ¨ä¸‹ä¸€æ­¥ï¼š

1. ä¸ºå¤šè¾¹å½¢æ ¡éªŒä¸è¾“å‡ºç”Ÿæˆæ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
2. æ·»åŠ  CIï¼ˆlintã€ç±»å‹æ£€æŸ¥ä¸ smoke æµ‹è¯•ï¼‰ã€‚
3. ä¸ºç›®å½•çº§å¤„ç†æ·»åŠ æ‰¹å¤„ç†æ¨¡å¼ CLIã€‚
4. æ”¯æŒå¤šç›®æ ‡æ©ç æˆ–å®ä¾‹åˆ†å‰²è¾“å‡ºã€‚
5. æ·»åŠ  Dockerfile ä¸éƒ¨ç½²æ–‡æ¡£ã€‚
6. æ·»åŠ åŸºå‡†ç¤ºä¾‹ä¸å¸¦é¢„æœŸè¾“å‡ºçš„æ ·ä¾‹æ•°æ®é›†ã€‚
7. å®Œæˆ `i18n/` ä¸‹çš„å¤šè¯­è¨€ README æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ã€‚

å»ºè®®å·¥ä½œæµï¼š

1. Fork ä»“åº“å¹¶åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ã€‚
2. è¿›è¡Œèšç„¦å˜æ›´å¹¶ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯ã€‚
3. åœ¨æœ¬åœ°æ‰‹åŠ¨éªŒè¯ Web + CLI æµç¨‹ã€‚
4. æäº¤ Pull Requestï¼Œè¯´æ˜è¡Œä¸ºå˜åŒ–å’Œæµ‹è¯•è¯æ®ã€‚

å»ºè®®è´¡çŒ®æ–¹å‘ï¼š
- ä¼˜åŒ–æç¤ºè¯è®¾è®¡ï¼Œæé«˜å¤šè¾¹å½¢æå–ç¨³å®šæ€§ã€‚
- æ”¹è¿›å‰ç«¯å¯è§†åŒ–ï¼ˆç¼©æ”¾/å¹³ç§»ã€è½®å»“å¹³æ»‘ï¼‰ã€‚
- æ„å»ºæµ‹è¯•å·¥å…·ä¸å¯å¤ç°æ ·ä¾‹å¤¹å…·ã€‚
- æ–‡æ¡£ä¸æœ¬åœ°åŒ–æ”¹è¿›ã€‚

## ğŸ“„ è®¸å¯è¯

å½“å‰ä»“åº“ä¸­å°šæœªåŒ…å«è®¸å¯è¯æ–‡ä»¶ã€‚

å‡è®¾ï¼šåœ¨æ˜ç¡®æ·»åŠ è®¸å¯è¯ä¹‹å‰ï¼Œé»˜è®¤ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

å¦‚æœä½ è®¡åˆ’å…±äº«æˆ–åˆ†å‘è¯¥é¡¹ç›®ï¼Œè¯·æ·»åŠ  `LICENSE` æ–‡ä»¶å¹¶æ›´æ–°æœ¬èŠ‚ã€‚
