[English](../README.md) Â· [Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©](README.ar.md) Â· [EspaÃ±ol](README.es.md) Â· [FranÃ§ais](README.fr.md) Â· [æ—¥æœ¬èª](README.ja.md) Â· [í•œêµ­ì–´](README.ko.md) Â· [Tiáº¿ng Viá»‡t](README.vi.md) Â· [ä¸­æ–‡ (ç®€ä½“)](README.zh-Hans.md) Â· [ä¸­æ–‡ï¼ˆç¹é«”ï¼‰](README.zh-Hant.md) Â· [Deutsch](README.de.md) Â· [Ğ ÑƒÑÑĞºĞ¸Ğ¹](README.ru.md)


# Segmentation d'organoÃ¯des (Web + CLI)

![Python](https://img.shields.io/badge/Python-3.x-blue.svg)
![Framework](https://img.shields.io/badge/Backend-Tornado-009688.svg)
![AI](https://img.shields.io/badge/OpenAI-Vision%20Segmentation-412991.svg)
![Status](https://img.shields.io/badge/README-First%20Complete%20Draft-success.svg)
![Interface](https://img.shields.io/badge/UI-Web%20%2B%20CLI-0ea5e9)
![Outputs](https://img.shields.io/badge/Artifacts-Overlay%20%7C%20Mask%20%7C%20JSON-f97316)
![PWA](https://img.shields.io/badge/PWA-Minimal%20Support-22c55e)

Une application Python pour segmenter des organoÃ¯des dans des images de microscopie Ã  l'aide de modÃ¨les OpenAI compatibles vision.

Ce dÃ©pÃ´t inclut :
- Un serveur web Tornado avec interface d'upload.
- Un flux CLI pour une utilisation en lot ou scriptÃ©e.
- Extraction de polygones, gÃ©nÃ©ration de masques et rendu d'images annotÃ©es.
- Prise en charge PWA minimale (manifest + cache service worker pour les ressources statiques principales).

## ğŸ” Vue d'ensemble

L'application accepte une image de microscopie en entrÃ©e, l'envoie Ã  un modÃ¨le OpenAI avec un prompt imposant un schÃ©ma JSON strict, puis renvoie un polygone unique traÃ§ant la frontiÃ¨re de l'organoÃ¯de.

### ğŸ“Œ En bref

| Zone | DÃ©tails |
|---|---|
| EntrÃ©e | Image de microscopie |
| Sortie principale | Polygone de l'organoÃ¯de (points `x, y`) |
| Fichiers dÃ©rivÃ©s | PNG d'overlay annotÃ©, PNG de masque binaire, JSON du polygone |
| Modes d'accÃ¨s | Interface web, CLI, appel API direct |
| Backend | Tornado (`server.py`) |
| Voie IA | OpenAI Responses API d'abord, Chat Completions en repli |

Artifacts gÃ©nÃ©rÃ©s :
- `*_annotated.png` : image source avec overlay rouge semi-transparent.
- `*_mask.png` : masque binaire de l'organoÃ¯de.
- `*_polygon.json` : sortie structurÃ©e (`width`, `height`, `polygon`, `confidence`).

Fichiers runtime principaux :
- `server.py` : application web + routes API.
- `organoid_segmenter.py` : logique de segmentation et de sortie image/masque.
- `segment_organoid.py` : wrapper CLI.

## âœ¨ FonctionnalitÃ©s

- Interface web sur `http://localhost:8888` pour une segmentation interactive rapide.
- Endpoint de type REST `POST /api/segment` avec prise en charge des uploads multipart.
- Nom de modÃ¨le configurable depuis l'UI et la CLI (`gpt-4o-2024-08-06` par dÃ©faut).
- Validation et limitation des points du polygone aux bornes de l'image.
- CrÃ©ation automatique des rÃ©pertoires de sortie (`uploads/`, `outputs/`).
- OpenAI Responses API en prioritÃ©, Chat Completions en repli dans le chemin de code.
- Prise en charge d'un service worker pour le cache des fichiers statiques principaux.

## ğŸ—‚ï¸ Structure du projet

```text
Yinghan/
â”œâ”€ organoid_segmenter.py          # Core segmentation logic and output rendering
â”œâ”€ segment_organoid.py            # CLI entrypoint
â”œâ”€ server.py                      # Tornado server + API
â”œâ”€ requirements.txt               # Python dependencies
â”œâ”€ templates/
â”‚  â””â”€ index.html                  # Web UI shell
â”œâ”€ static/
â”‚  â”œâ”€ app.js                      # Frontend upload + result rendering logic
â”‚  â”œâ”€ styles.css                  # UI styles
â”‚  â”œâ”€ manifest.json               # PWA manifest
â”‚  â””â”€ sw.js                       # Service worker cache logic
â”œâ”€ i18n/                          # Localized README files (planned/generated by pipeline)
â”œâ”€ uploads/                       # Runtime upload storage (gitignored)
â”œâ”€ outputs/                       # Runtime segmentation outputs (gitignored, created at runtime)
â””â”€ .auto-readme-work/             # README generation pipeline context/artifacts
```

## âœ… PrÃ©requis

- Python 3.10+ (3.x requis ; 3.11 recommandÃ©).
- ClÃ© API OpenAI avec accÃ¨s Ã  un modÃ¨le compatible vision.
- AccÃ¨s rÃ©seau depuis l'environnement d'exÃ©cution vers les APIs OpenAI.

## âš™ï¸ Installation

```bash
git clone <your-repo-url>
cd Yinghan

python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate

pip install -r requirements.txt
```

DÃ©finissez votre clÃ© API :

```bash
export OPENAI_API_KEY="your_api_key_here"  # Windows PowerShell: $env:OPENAI_API_KEY="your_api_key_here"
```

## ğŸš€ Utilisation

### ğŸŒ Lancer l'application web

```bash
python server.py
```

Ouvrez :

```text
http://localhost:8888
```

Flux web :
1. Choisissez une image.
2. Modifiez Ã©ventuellement le modÃ¨le dans le champ de saisie.
3. Cliquez sur **Segment**.
4. Examinez l'overlay, l'image annotÃ©e et le masque.

### ğŸ§ª Lancer la CLI

```bash
python segment_organoid.py /path/to/image.jpg
```

Arguments optionnels :

```bash
python segment_organoid.py /path/to/image.jpg --out-dir outputs --model gpt-4o-2024-08-06
```

La CLI affiche les chemins de sortie et un rÃ©sumÃ© contenant les dimensions de l'image et le nombre de points du polygone.

### ğŸ”Œ Appeler l'API directement

```bash
curl -X POST http://localhost:8888/api/segment \
  -F "image=@/path/to/image.jpg" \
  -F "model=gpt-4o-2024-08-06"
```

Exemple de format de rÃ©ponse :

```json
{
  "width": 1024,
  "height": 1024,
  "polygon": [[100.0, 120.0], [110.0, 125.0]],
  "confidence": 0.92,
  "annotated_url": "/outputs/example_annotated.png",
  "mask_url": "/outputs/example_mask.png",
  "json_url": "/outputs/example_polygon.json",
  "upload_url": "/uploads/upload.jpg"
}
```

## ğŸ› ï¸ Configuration

ParamÃ¨tres actuellement configurables dans le code :

- `model` :
  - Par dÃ©faut : `gpt-4o-2024-08-06`
  - DÃ©finissable via le champ du formulaire web ou la CLI `--model`
- `out_dir` :
  - Option CLI `--out-dir` (par dÃ©faut `outputs`)
  - Le serveur utilise `outputs/` en interne

Variables d'environnement :
- `OPENAI_API_KEY` (obligatoire).

HypothÃ¨ses :
- Le client `OpenAI()` utilise des identifiants basÃ©s sur l'environnement.
- Aucune URL de base personnalisÃ©e ni configuration org/projet n'est requise, sauf si votre configuration de compte OpenAI l'exige.

## ğŸ§¾ Exemples

### ğŸ Utilisation Python programmatique

```python
from organoid_segmenter import segment_organoid

result = segment_organoid(
    image_path="sample.jpg",
    out_dir="outputs",
    model="gpt-4o-2024-08-06",
)

print(result.annotated_path)
print(result.mask_path)
print(result.json_path)
print(result.confidence)
```

### ğŸ“„ Inspecter le JSON du polygone

```bash
cat outputs/<name>_polygon.json
```

### ğŸ§± Fichiers de sortie typiques

```text
outputs/
â”œâ”€ <base>_<timestamp>_annotated.png
â”œâ”€ <base>_<timestamp>_mask.png
â””â”€ <base>_<timestamp>_polygon.json
```

## ğŸ§  Notes de dÃ©veloppement

- Framework backend : Tornado (`server.py`).
- Stack frontend : HTML/CSS/JS statiques (`templates/index.html`, `static/app.js`).
- Le service worker s'enregistre au chargement de la page et met en cache les ressources principales listÃ©es dans `static/sw.js`.
- La validation du polygone garantit au moins 3 points et limite les coordonnÃ©es aux frontiÃ¨res de l'image.
- La gÃ©nÃ©ration des sorties utilise Pillow (`PIL.Image`, `ImageDraw`).

Conseils de dÃ©veloppement local :

```bash
# Run server
python server.py

# Run CLI against an existing image
python segment_organoid.py 6f1e1874eacffe1dbae0393f48811e74.jpg
```

## ğŸ©º DÃ©pannage

- `openai.AuthenticationError` ou similaire :
  - VÃ©rifiez que `OPENAI_API_KEY` est dÃ©fini dans le shell qui exÃ©cute Python.
- `Model response did not contain valid JSON` :
  - Essayez un autre modÃ¨le ou relancez ; un parsing de secours est implÃ©mentÃ©, mais une sortie mal formÃ©e peut tout de mÃªme Ã©chouer.
- `Polygon must contain at least 3 points` :
  - Le modÃ¨le a renvoyÃ© un polygone invalide ; rÃ©essayez avec une image plus nette.
- L'UI se charge mais la segmentation Ã©choue :
  - Consultez les logs serveur pour le type d'exception renvoyÃ© par `/api/segment`.
- `ModuleNotFoundError` :
  - RÃ©installez les dÃ©pendances avec `pip install -r requirements.txt` dans l'environnement actif.

## ğŸ›£ï¸ Feuille de route

Ã‰tapes potentielles suivantes pour ce dÃ©pÃ´t :

1. Ajouter des tests automatisÃ©s pour la validation des polygones et la gÃ©nÃ©ration des sorties.
2. Ajouter une CI (lint, vÃ©rifications de types et smoke tests).
3. Ajouter un mode CLI batch pour un traitement au niveau rÃ©pertoire.
4. Prendre en charge plusieurs masques d'objet ou une sortie de segmentation par instance.
5. Ajouter un Dockerfile et une documentation de dÃ©ploiement.
6. Ajouter des exemples de benchmark et des jeux de donnÃ©es d'exemple avec sorties attendues.
7. Finaliser les fichiers README multilingues sous `i18n/`.

## ğŸ¤ Contribution

Les contributions sont les bienvenues.

Workflow recommandÃ© :

1. Forkez le dÃ©pÃ´t et crÃ©ez une branche de fonctionnalitÃ©.
2. Effectuez des changements ciblÃ©s avec des messages de commit clairs.
3. Validez localement les flux web + CLI manuels.
4. Ouvrez une pull request dÃ©crivant les changements de comportement et les preuves de test.

Domaines de contribution suggÃ©rÃ©s :
- Meilleure conception de prompt pour une extraction de polygone plus stable.
- AmÃ©lioration de la visualisation frontend (zoom/pan, lissage de contour).
- Harnais de test et fixtures d'exemple reproductibles.
- AmÃ©liorations de documentation et de localisation.

## ğŸ“„ Licence

Aucun fichier de licence n'est actuellement prÃ©sent dans ce dÃ©pÃ´t.

HypothÃ¨se : tous les droits sont rÃ©servÃ©s par dÃ©faut tant qu'une licence n'est pas explicitement ajoutÃ©e.

Si vous prÃ©voyez de partager ou distribuer ce projet, ajoutez un fichier `LICENSE` et mettez Ã  jour cette section.
